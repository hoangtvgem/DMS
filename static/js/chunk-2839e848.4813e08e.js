(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2839e848"],{"3cbe":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{align:"center",label:"ID",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.$index)+" ")]}}])}),n("el-table-column",{attrs:{label:"Tên tài liệu"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" ")]}}])}),n("el-table-column",{attrs:{label:"Người sở hữu",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.ownerName))])]}}])}),n("el-table-column",{attrs:{label:"Trạng thái",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t.statusDocument[e.row.status]))])]}}])}),n("el-table-column",{attrs:{label:"Thao tác",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["pending"==e.row.status?n("span",[e.row.currentProcessId==t.idProfile?n("button",{staticClass:"btn-primary",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.approveDocument(e.row)}}},[t._v("Duyệt")]):t._e(),e.row.currentProcessId==t.idProfile&&e.row.process[e.row.process.length-1]==t.idProfile?n("button",{staticClass:"btn-primary",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.approveDocument(e.row,!0)}}},[t._v("Duyệt và ban hành")]):t._e(),e.row.currentProcessId==t.idProfile&&e.row.process[e.row.process.length-1]==t.idProfile?n("button",{staticClass:"btn-primary",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.showRequestModal(e.row)}}},[t._v(" Duyệt và yêu cầu duyệt ")]):t._e(),e.row.currentProcessId==t.idProfile?n("button",{staticClass:"btn-danger",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.showModal(e.row)}}},[t._v("Từ chối")]):t._e()]):t._e(),"created"==e.row.status&&e.row.owner==t.idProfile?n("button",{staticClass:"btn-primary",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.requestDocument(e.row)}}},[t._v("Yêu cầu duyệt")]):t._e(),n("button",{staticClass:"btn-primary",staticStyle:{"margin-right":"20px"},on:{click:function(n){return t.viewDocument(e.row._id)}}},[n("i",{staticClass:"el-icon-view"})]),e.row.owner==t.idProfile?n("button",{staticClass:"btn-primary",on:{click:function(n){return t.editDocument(e.row._id)}}},[n("i",{staticClass:"el-icon-edit"})]):t._e(),e.row.owner==t.idProfile?n("button",{staticClass:"btn-danger",staticStyle:{"margin-left":"20px"},on:{click:function(n){return t.deleteDocument(e.row._id)}}},[n("i",{staticClass:"el-icon-delete"})]):t._e()]}}])})],1),n("Modal",{directives:[{name:"show",rawName:"v-show",value:t.isModalRequestVisible,expression:"isModalRequestVisible"}],on:{close:t.closeModal},scopedSlots:t._u([{key:"header",fn:function(){return[t._v(" Yêu cầu duyệt thêm ")]},proxy:!0},{key:"body",fn:function(){return[n("el-form",{ref:"form"},[n("el-form-item",{attrs:{label:"Người duyệt thêm"}},[n("el-select",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{placeholder:"Người duyệt thêm"},model:{value:t.userApproveMore,callback:function(e){t.userApproveMore=e},expression:"userApproveMore"}},t._l(t.listUser,(function(t,e){return n("el-option",{key:e,attrs:{label:t.fullname,value:t._id}})})),1)],1)],1)]},proxy:!0},{key:"footer",fn:function(){return[n("button",{staticClass:"btn-green",staticStyle:{width:"50px",display:"inline-flex"},attrs:{type:"button","aria-label":"Close modal"},on:{click:function(e){return t.approveAndRequestDocument()}}},[t._v(" Lưu ")])]},proxy:!0}])}),n("Modal",{directives:[{name:"show",rawName:"v-show",value:t.isModalVisible,expression:"isModalVisible"}],on:{close:t.closeModal},scopedSlots:t._u([{key:"header",fn:function(){return[t._v(" Lý do từ chối duyệt ")]},proxy:!0},{key:"body",fn:function(){return[n("el-form",{ref:"form",attrs:{model:t.form,"label-width":"0px"}},[n("el-form-item",[n("el-input",{staticStyle:{width:"400px"},attrs:{type:"textarea"},model:{value:t.form.reason,callback:function(e){t.$set(t.form,"reason",e)},expression:"form.reason"}})],1)],1)]},proxy:!0},{key:"footer",fn:function(){return[n("button",{staticClass:"btn-green",staticStyle:{width:"50px",display:"inline-flex"},attrs:{type:"button","aria-label":"Close modal"},on:{click:function(e){return t.rejectDocument()}}},[t._v(" Lưu ")])]},proxy:!0}])})],1)},o=[],s=n("5530"),a=n("424e"),r=n("c24f"),c=n("aff5"),l={components:{Modal:c["a"]},filters:{statusFilter:function(t){var e={published:"success",draft:"gray",deleted:"danger"};return e[t]}},data:function(){return{list:null,listLoading:!0,idProfile:JSON.parse(localStorage.getItem("profile")).id,statusDocument:{created:"Đã tạo mới",pending:"Đang trong quá trình duyệt",approved:"Đã duyệt",cancel:"Đã bị hủy",reject:"Bị từ chối duyệt"},isModalVisible:!1,isModalRequestVisible:!1,userApproveMore:null,listUser:[],form:{reason:""},dataReject:null}},created:function(){this.fetchData()},methods:{showModal:function(t){this.dataReject=t,this.isModalVisible=!0},showRequestModal:function(t){this.dataReject=t,this.isModalRequestVisible=!0},closeModal:function(){this.isModalVisible=!1,this.isModalRequestVisible=!1},fetchData:function(){var t=this;this.getList(),Object(r["g"])().then((function(e){t.listUser=e.data.data}))},getList:function(){var t=this;this.listLoading=!0,Object(a["f"])({isWaitingApprove:!0}).then((function(e){t.list=e.data.data,t.listLoading=!1}))},approveAndRequestDocument:function(t){var e=this;this.dataReject.process.push(this.userApproveMore),Object(a["c"])(Object(s["a"])(Object(s["a"])({},this.dataReject),{},{process:this.dataReject.process,currentProcessId:this.dataReject.process[this.dataReject.process.indexOf(this.idProfile)+1]||this.dataReject.currentProcessId})).then((function(t){e.getList(),e.isModalRequestVisible=!1,e.$message("Duyệt tài liệu thành công")}))},approveDocument:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(a["c"])(Object(s["a"])(Object(s["a"])({},t),{},{status:t.process[t.process.length-1]==this.idProfile?n?"publish":"approved":t.status,currentProcessId:t.process[t.process.indexOf(this.idProfile)+1]||t.currentProcessId})).then((function(t){e.getList(),e.$message("Duyệt tài liệu thành công")}))},rejectDocument:function(){var t=this;Object(a["c"])(Object(s["a"])(Object(s["a"])({},this.dataReject),{},{idUserReason:this.dataReject.currentProcessId,currentProcessId:this.dataReject.process[0],status:"reject",reason:this.form.reason})).then((function(e){t.getList(),t.closeModal(),t.$message("Từ chối duyệt tài liệu thành công")}))},requestDocument:function(t){var e=this;Object(a["c"])(Object(s["a"])(Object(s["a"])({},t),{},{status:"pending"})).then((function(t){e.getList(),e.$message("Yêu cầu duyệt tài liệu thành công")}))},deleteDocument:function(t){var e=this;Object(a["b"])({_id:t}).then((function(t){e.fetchData()}))},editDocument:function(t){this.$router.push("/DMS/document/".concat(t,"/edit"))},viewDocument:function(t){this.$router.push("/DMS/document/".concat(t,"/view"))}}},u=l,d=n("2877"),f=Object(d["a"])(u,i,o,!1,null,null,null);e["default"]=f.exports},"3e06":function(t,e,n){},"424e":function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return a})),n.d(e,"e",(function(){return r})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return l}));var i=n("b775");function o(){return Object(i["a"])({url:"/api/get/documentDashboard",method:"get"})}function s(t){return Object(i["a"])({url:"/api/get/documentList",method:"get",params:t})}function a(t){return Object(i["a"])({url:"/api/document/create",method:"post",data:t})}function r(t){return Object(i["a"])({url:"/api/document/getDetail",method:"get",params:t})}function c(t){return Object(i["a"])({url:"/api/document/edit",method:"put",data:t})}function l(t){return Object(i["a"])({url:"/api/document/delete",method:"delete",data:t})}},aff5:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"modal-fade"}},[n("div",{staticClass:"modal-backdrop"},[n("div",{staticClass:"modal",attrs:{role:"dialog","aria-labelledby":"modalTitle","aria-describedby":"modalDescription"}},[n("header",{staticClass:"modal-header",attrs:{id:"modalTitle"}},[t._t("header"),n("button",{staticClass:"btn-close",attrs:{type:"button","aria-label":"Close modal"},on:{click:t.close}},[t._v(" x ")])],2),n("section",{staticClass:"modal-body",attrs:{id:"modalDescription"}},[t._t("body")],2),n("footer",{staticClass:"modal-footer",staticStyle:{display:"inline-flex"}},[t._t("footer"),n("button",{staticClass:"btn-white",staticStyle:{width:"60px",display:"inline-flex","text-align":"center","margin-left":"10px"},attrs:{type:"button","aria-label":"Close modal"},on:{click:t.close}},[t._v(" Đóng ")])],2)])])])},o=[],s={name:"Modal",methods:{close:function(){this.$emit("close")}}},a=s,r=(n("bdd7"),n("2877")),c=Object(r["a"])(a,i,o,!1,null,null,null);e["a"]=c.exports},bdd7:function(t,e,n){"use strict";n("3e06")}}]);