(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6aa1279e"],{"295f":function(e,t,i){},"323b":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[i("el-form-item",{staticClass:"is-required",attrs:{label:"Tên tài liệu"}},[i("el-input",{attrs:{disabled:e.isView},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{staticClass:"is-required",attrs:{label:"Loại tài liệu"}},[i("el-select",{attrs:{disabled:e.isView,placeholder:"Chọn loại văn bản"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.listDocumentType,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e._id}})})),1)],1),i("el-form-item",{staticClass:"is-required",attrs:{label:"Người sở hữu"}},[i("el-select",{attrs:{disabled:e.isView,placeholder:"Chọn người sở hữu"},model:{value:e.form.owner,callback:function(t){e.$set(e.form,"owner",t)},expression:"form.owner"}},e._l(e.listUser,(function(e,t){return i("el-option",{key:t,attrs:{label:e.fullname,value:e._id}})})),1)],1),i("hr"),i("el-form-item",{staticClass:"is-required",attrs:{label:"Người duyệt"}},e._l(e.listUserApproval,(function(t,a){return i("span",[i("el-select",{class:{"is-current":(e.isEdit||e.isView)&&e.indexCurrent==a},staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{placeholder:"Chọn người duyệt",disabled:e.isEdit&&e.indexCurrent>=a||e.isView},model:{value:e.listUserApproval[a],callback:function(t){e.$set(e.listUserApproval,a,t)},expression:"listUserApproval[index]"}},e._l(e.listUser.filter((function(t){return 0==a||a>0&&t.position.level<e.getLevel(e.listUserApproval[a-1])})),(function(e,t){return i("el-option",{key:t,attrs:{label:e.fullname,value:e._id}})})),1),!e.isView||e.isView&&a!=e.listUserApproval.length-1?i("span",[e.isView||e.isEdit?i("i",{staticClass:"el-icon-right",staticStyle:{"margin-right":"10px"}}):e._e()]):e._e()],1)})),0),i("hr"),e.isView?i("el-form-item",{attrs:{label:"Tệp tải lên"}},[e.fileBase64||e.form.viewLinkDrive?i("div",[i("label",{staticClass:"el-form-item__label"},[e._v("Xem trước")]),i("strong",{staticStyle:{display:"inline-flex"}},[e._v("Phiên bản:")]),i("span",{staticStyle:{display:"inline-flex","margin-left":"20px"}},[e._v(e._s(e.form.version))]),i("iframe",{staticStyle:{width:"100%",height:"600px",border:"none"},attrs:{src:"pdf"==e.typeBase64?e.fileBase64:e.form.viewLinkDrive&&e.form.viewLinkDrive.replace("/view","/preview")}})]):e._e(),i("div"),e.fileBase64?i("div",[i("label",{staticClass:"el-form-item__label"},[e._v("SFTP Server")]),i("a",{staticClass:"btn-link",attrs:{target:"_blank",href:e.fileBase64}},[i("i",{staticClass:"el-icon-download"}),e._v(" Tải xuống file tài liệu")])]):e._e(),e.form.viewLinkDrive?i("div",{staticStyle:{"margin-top":"20px"}},[i("label",{staticClass:"el-form-item__label"},[e._v("Google Drive")]),i("a",{staticClass:"btn-link",attrs:{target:"_blank",href:e.form.viewLinkDrive}},[i("i",{staticClass:"el-icon-view"}),e._v(" Xem file tài liệu")]),i("a",{staticClass:"btn-link",attrs:{target:"_blank",href:e.form.downloadLinkDrive}},[i("i",{staticClass:"el-icon-download"}),e._v(" Tải xuống file tài liệu")])]):e._e()]):i("el-form-item",{staticClass:"is-required",attrs:{label:"Tải tệp lên"}},[i("el-upload",{staticClass:"upload-demo",attrs:{drag:"",accept:"application/pdf,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",action:"/","auto-upload":!1,"file-list":e.fileList,"on-change":e.handleChange,disabled:!!e.fileList.length}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[e._v("Kéo thả vào đây hoặc "),i("em",[e._v("click để chọn tệp")])]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("Chỉ được tải lên file không quá 1GB")])])],1),e.isView?e._e():i("el-form-item",{attrs:{label:"Vị trí lưu"}},[i("el-checkbox-group",{model:{value:e.drive,callback:function(t){e.drive=t},expression:"drive"}},[i("el-checkbox",{attrs:{label:"SFTP Server",name:"sftp"}}),i("el-checkbox",{attrs:{label:"Google Drive",name:"drive"}})],1)],1),e.isView?[i("el-form-item",{attrs:{label:"Trạng thái"}},[e._v(" "+e._s(e.statusDocument[e.form.status])+" ")]),"reject"==e.form.status?[i("el-form-item",{attrs:{label:"Lý do"}},[i("el-input",{staticStyle:{width:"400px"},attrs:{disabled:"",type:"textarea"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1),i("el-form-item",{attrs:{label:"Người từ chối"}},[i("el-select",{class:{"is-current":(e.isEdit||e.isView)&&e.indexCurrent==e.index},staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{placeholder:"Người từ chối duyệt",disabled:e.isEdit&&e.indexCurrent>=e.index||e.isView},model:{value:e.form.idUserReason,callback:function(t){e.$set(e.form,"idUserReason",t)},expression:"form.idUserReason"}},e._l(e.listUser,(function(e,t){return i("el-option",{key:t,attrs:{label:e.fullname,value:e._id}})})),1)],1)]:e._e()]:e._e(),e.isView?e._e():i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("Lưu")]),i("el-button",{on:{click:e.onCancel}},[e._v("Hủy")])],1)],2)],1)},n=[],r=i("5530"),l=i("c7eb"),o=i("1da1"),s=(i("4de4"),i("d3b7"),i("b0c0"),i("424e")),d=i("cabf"),c=i("bc3a"),u=i.n(c),p=i("c24f"),f=i("5f87"),m={data:function(){return{form:{name:"",level:1,owner:JSON.parse(localStorage.getItem("profile")).id},fileBase64:"",typeBase64:"",drive:[],listUser:[],file:null,fileList:[],value:null,options:["list","of","options"],listUserApproval:[null],indexCurrent:0,isEdit:"edit"==this.$route.params.mode,isView:"view"==this.$route.params.mode,listDocumentType:[],statusDocument:{created:"Đã tạo mới",pending:"Đang trong quá trình duyệt",approved:"Đã duyệt",cancel:"Đã bị hủy",reject:"Bị từ chối duyệt"}}},created:function(){var e=this;this.fetchData(),(this.isEdit||this.isView)&&Object(s["e"])({id:this.$route.params.id}).then((function(t){e.form=t.data.data;var i=e.getTypeBase64(t.data.data.fileName.split(".")[1]);e.typeBase64=i,e.form.version=t.data.data.version||1,e.fileBase64="data:application/".concat(i,";base64,")+t.data.file,e.indexCurrent=e.form.process.indexOf(e.form.currentProcessId),e.listUserApproval=t.data.data.process}))},methods:{getTypeBase64:function(e){switch(e){case"dot":return"msword";case"docx":return"vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"vnd.openxmlformats-officedocument.wordprocessingml.template";case"xla":return"vnd.ms-excel";case"xlsx":return"vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"ppa":return"vnd.ms-powerpoint";case"pdf":return"pdf"}return e},handleChange:function(e){this.file=e},getLevel:function(e){return this.listUser.filter((function(t){return t._id==e}))[0].position.level},onAdd:function(){this.listUserApproval.push(null)},uploadFile:function(){var e=this;return Object(o["a"])(Object(l["a"])().mark((function t(){var i,a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.file){t.next=12;break}return i=new FormData,i.append("file",e.file.raw),i.append("name",e.file.name),i.append("type",e.file.raw.type),i.append("drive",e.drive),t.next=8,u.a.post("http://localhost:5555/api/document/upload",i,{headers:{"Content-Type":"multipart/form-data",Authorization:Object(f["a"])()}});case 8:return a=t.sent,t.abrupt("return",a);case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))()},onSubmit:function(){var e=this;return Object(o["a"])(Object(l["a"])().mark((function t(){var i,a,n,o,d,c,u,p,f,m,v,b,h,w,g,x,k,_,y,C,L;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.uploadFile();case 2:i=t.sent,i||(alert("Vui lòng upload file"),returns),e.isEdit?Object(s["c"])(Object(r["a"])(Object(r["a"])({},e.form),{},{version:e.form.version+1,viewLinkSFTP:null===(a=i.data)||void 0===a||null===(n=a.dataSFTP)||void 0===n?void 0:n.webViewLink,viewLinkDrive:null===(o=i.data)||void 0===o||null===(d=o.dataDrive)||void 0===d?void 0:d.webViewLink,downloadLinkSFTP:null===(c=i.data)||void 0===c||null===(u=c.dataSFTP)||void 0===u?void 0:u.webContentLink,downloadLinkDrive:null===(p=i.data)||void 0===p||null===(f=p.dataDrive)||void 0===f?void 0:f.webContentLink,fileName:null===(m=i.data)||void 0===m||null===(v=m.dataSFTP)||void 0===v?void 0:v.fileName,process:e.listUserApproval,reason:""})).then((function(t){e.$message("Cập nhật tài liệu thành công")})):(e.listUserApproval.unshift(e.form.owner),Object(s["a"])(Object(r["a"])(Object(r["a"])({},e.form),{},{version:1,process:e.listUserApproval,currentProcessId:e.form.owner,viewLinkSFTP:null===(b=i.data)||void 0===b||null===(h=b.dataSFTP)||void 0===h?void 0:h.webViewLink,viewLinkDrive:null===(w=i.data)||void 0===w||null===(g=w.dataDrive)||void 0===g?void 0:g.webViewLink,downloadLinkSFTP:null===(x=i.data)||void 0===x||null===(k=x.dataSFTP)||void 0===k?void 0:k.webContentLink,downloadLinkDrive:null===(_=i.data)||void 0===_||null===(y=_.dataDrive)||void 0===y?void 0:y.webContentLink,fileName:null===(C=i.data)||void 0===C||null===(L=C.dataSFTP)||void 0===L?void 0:L.fileName})).then((function(t){e.$message("Tạo mới tài liệu thành công")})));case 5:case"end":return t.stop()}}),t)})))()},onCancel:function(){this.$message({message:"cancel!",type:"warning"})},fetchData:function(){var e=this;Object(p["g"])().then((function(t){e.listUser=t.data.data})),Object(d["e"])().then((function(t){e.listDocumentType=t.data.data}))}}},v=m,b=(i("7614"),i("2877")),h=Object(b["a"])(v,a,n,!1,null,"5cf6e15e",null);t["default"]=h.exports},"424e":function(e,t,i){"use strict";i.d(t,"d",(function(){return n})),i.d(t,"f",(function(){return r})),i.d(t,"a",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return d}));var a=i("b775");function n(){return Object(a["a"])({url:"/api/get/documentDashboard",method:"get"})}function r(e){return Object(a["a"])({url:"/api/get/documentList",method:"get",params:e})}function l(e){return Object(a["a"])({url:"/api/document/create",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/api/document/getDetail",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/api/document/edit",method:"put",data:e})}function d(e){return Object(a["a"])({url:"/api/document/delete",method:"delete",data:e})}},7614:function(e,t,i){"use strict";i("295f")},cabf:function(e,t,i){"use strict";i.d(t,"e",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"d",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return s}));var a=i("b775");function n(e){return Object(a["a"])({url:"/api/get/documentTypeList",method:"get",params:e})}function r(e){return Object(a["a"])({url:"/api/documentType/create",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/api/documentType/getDetail",method:"get",params:e})}function o(e){return Object(a["a"])({url:"/api/documentType/edit",method:"put",data:e})}function s(e){return Object(a["a"])({url:"/api/documentType/delete",method:"delete",data:e})}}}]);